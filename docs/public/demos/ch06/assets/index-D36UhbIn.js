(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();class w{gameTime=0;maxStep=.05;lastTime=0;fps=0;isPaused=!1;tick(){if(this.isPaused)return 0;const t=performance.now();let s=(t-this.lastTime)/1e3;return this.fps=1e3/(t-this.lastTime),this.lastTime=t,s>this.maxStep&&(s=this.maxStep),this.gameTime+=s,s}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTime=performance.now()}getGameTime(){return this.gameTime}getFPS(){return Math.round(this.fps)}}class M{keys=new Set;justPressed=new Set;justReleased=new Set;onKeyDown=t=>{t.repeat||(this.keys.add(t.key),this.justPressed.add(t.key))};onKeyUp=t=>{this.keys.delete(t.key),this.justReleased.add(t.key)};constructor(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}update(){this.justPressed.clear(),this.justReleased.clear()}isDown(t){return this.keys.has(t)}wasPressed(t){return this.justPressed.has(t)}wasReleased(t){return this.justReleased.has(t)}}class P{entities=[];add(t){this.entities.push(t)}remove(t){this.entities=this.entities.filter(s=>s!==t)}update(t,s){for(const i of this.entities)i.update(t,s);this.handleCollisions(),this.entities=this.entities.filter(i=>i.alive)}render(t){for(const s of this.entities)s.render(t)}clear(){this.entities=[]}handleCollisions(){const t=this.entities.filter(i=>"colliderType"in i),s=i=>typeof i.layer=="number"&&typeof i.mask=="number";for(let i=0;i<t.length;i++)for(let e=i+1;e<t.length;e++){const n=t[i],o=t[e];if(s(n)&&s(o)&&((n.mask&o.layer)===0||(o.mask&n.layer)===0))continue;let a=!1;if(n.colliderType==="circle"&&o.colliderType==="circle"){const r=n.position.x-o.position.x,h=n.position.y-o.position.y;Math.sqrt(r*r+h*h)<n.radius+o.radius&&(a=!0)}else if(n.colliderType==="box"&&o.colliderType==="box")n.position.x<o.position.x+o.width&&n.position.x+n.width>o.position.x&&n.position.y<o.position.y+o.height&&n.position.y+n.height>o.position.y&&(a=!0);else{let r,h;n.colliderType==="circle"?(r=n,h=o):(r=o,h=n);const p=Math.max(h.position.x,Math.min(r.position.x,h.position.x+h.width)),y=Math.max(h.position.y,Math.min(r.position.y,h.position.y+h.height)),d=r.position.x-p,u=r.position.y-y;d*d+u*u<r.radius*r.radius&&(a=!0)}a&&(n.onCollision(o),o.onCollision(n))}}}class S{timer=new w;input=new M;entityManager=new P;isRunning=!1;hasLoopStarted=!1;ctx;uiLayers=[];uiCanvas;uiCtx;uiUpdateIntervalMs=0;uiTimeSinceUpdateMs=0;get screenSize(){return{x:this.ctx.canvas.width,y:this.ctx.canvas.height}}get running(){return this.isRunning}init(t){const s=document.querySelector(t.selector);if(!s)throw new Error(`Element with selector "${t.selector}" not found.`);const i=document.createElement("canvas");i.width=t.width||800,i.height=t.height||600,i.style.backgroundColor=t.backgroundColor||"black",i.id="game",s.appendChild(i),i.focus();const e=i.getContext("2d");if(!e)throw new Error("Failed to get 2D context from canvas.");this.ctx=e,this.onInit()}onInit(){}start(){this.isRunning||(this.isRunning=!0,this.timer.resume(),this.onResume(),this.hasLoopStarted||(this.hasLoopStarted=!0,requestAnimationFrame(this.gameLoop.bind(this))))}stop(){this.isRunning=!1,this.timer.pause(),this.onPause()}onPause(){}onResume(){}canTogglePause(){return!0}gameLoop(){this.input.wasPressed("Escape")&&this.canTogglePause()&&(this.isRunning?this.stop():(this.isRunning=!0,this.timer.resume(),this.onResume()));let t=0;this.isRunning&&(t=this.timer.tick(),this.update(t),this.render());const s=this.isRunning?t:1/60;this.updateAndRenderUI(s),this.input.update(),requestAnimationFrame(this.gameLoop.bind(this))}update(t){this.entityManager.update(t,this.screenSize)}render(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.entityManager.render(this.ctx),t&&t(),this.ctx.restore()}updateAndRenderUI(t){if(!this.uiCtx||this.uiLayers.length===0||(this.uiTimeSinceUpdateMs+=t*1e3,this.uiUpdateIntervalMs>0&&this.uiTimeSinceUpdateMs<this.uiUpdateIntervalMs))return;this.uiTimeSinceUpdateMs=0;const s=this.uiCanvas.width,i=this.uiCanvas.height;for(const e of this.uiLayers)e.update(t);this.uiCtx.clearRect(0,0,s,i);for(const e of this.uiLayers)e.render(this.uiCtx,s,i)}addUILayer(t){this.uiCtx||this.createUiCanvas(),this.uiLayers.push(t)}removeUILayer(t){this.uiLayers=this.uiLayers.filter(s=>s!==t)}setUiUpdateInterval(t){this.uiUpdateIntervalMs=Math.max(0,t)}createUiCanvas(){const t=this.ctx.canvas.parentElement;if(!t)return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");const i=document.createElement("canvas");i.width=this.ctx.canvas.width,i.height=this.ctx.canvas.height,i.style.position="absolute",i.style.left="0",i.style.top="0";const e=this.ctx.canvas,n=window.getComputedStyle(e);i.style.width=n.width||e.style.width||"100%",i.style.height=n.height||e.style.height||"100%",i.style.aspectRatio=n.aspectRatio||e.style.aspectRatio||`${e.width} / ${e.height}`,i.style.objectFit=n.objectFit||e.style.objectFit||"contain",i.style.display=n.display||"block",i.style.pointerEvents="none",i.style.zIndex="2",i.id="ui",t.appendChild(i);const o=i.getContext("2d");if(!o)throw new Error("Failed to get 2D context from UI canvas.");this.uiCanvas=i,this.uiCtx=o}addEntity(t){this.entityManager.add(t)}}class g{position;alive;constructor(t={x:0,y:0},s=!0){this.position=t,this.alive=s}}class L{input;constructor(t){this.input=t}getRotation(){return this.input.isDown("ArrowLeft")?-1:this.input.isDown("ArrowRight")?1:0}isThrusting(){return this.input.isDown("ArrowUp")}}class C extends g{radius=15;colliderType="circle";angle=0;velocity={x:0,y:0};thrust=0;friction=.98;controller;constructor(t,s){super(t),this.controller=s}update(t,s){this.angle+=this.controller.getRotation()*180*t,this.controller.isThrusting()?this.thrust=200:this.thrust=0,this.velocity.x+=Math.cos(this.angle*Math.PI/180)*this.thrust*t,this.velocity.y+=Math.sin(this.angle*Math.PI/180)*this.thrust*t,this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t;const i=s.x,e=s.y;this.position.x<0&&(this.position.x+=i),this.position.x>i&&(this.position.x-=i),this.position.y<0&&(this.position.y+=e),this.position.y>e&&(this.position.y-=e)}render(t){const i=this.radius*1.3;t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle*Math.PI/180),t.beginPath(),t.moveTo(i,0),t.lineTo(-i*.6,-i*.6),t.lineTo(-i*.3,0),t.lineTo(-i*.6,i*.6),t.closePath(),t.strokeStyle="#ffffff",t.lineWidth=2,t.lineJoin="round",t.stroke(),t.restore()}getAngle(){return this.angle}onCollision(t){this.alive=!1}}class m extends g{radius=2;colliderType="circle";velocity;constructor(t,s,i=400){super(t);const e=s*Math.PI/180;this.velocity={x:Math.cos(e)*i,y:Math.sin(e)*i}}update(t,s){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,(this.position.x<0||this.position.x>s.x||this.position.y<0||this.position.y>s.y)&&(this.alive=!1)}render(t){t.save(),t.translate(this.position.x,this.position.y),t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.fillStyle="#ffff00",t.fill(),t.restore()}onCollision(t){this.alive=!1}}const T={XL:48,L:32,M:22,S:14},I={XL:"L",L:"M",M:"S",S:null};class c extends g{radius;colliderType="circle";size;angle;rotationSpeed;velocity;shapePoints;shouldSplit=!1;hasSplit=!1;constructor(t,s="L"){super(t),this.size=s,this.radius=T[s],this.angle=Math.random()*360,this.rotationSpeed=(Math.random()-.5)*90;const i=50+Math.random()*100,e=Math.random()*Math.PI*2;this.velocity={x:Math.cos(e)*i,y:Math.sin(e)*i};const n=8;this.shapePoints=Array.from({length:n},(o,a)=>({angle:a*Math.PI*2/n,scale:.75+Math.random()*.5}))}update(t,s){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t;const i=s.x,e=s.y;this.position.x<0&&(this.position.x+=i),this.position.x>i&&(this.position.x-=i),this.position.y<0&&(this.position.y+=e),this.position.y>e&&(this.position.y-=e),this.angle+=this.rotationSpeed*t}render(t){const s=this.radius;t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle*Math.PI/180),t.beginPath();const i=this.shapePoints[0];t.moveTo(Math.cos(i.angle)*s*i.scale,Math.sin(i.angle)*s*i.scale);for(let e=1;e<this.shapePoints.length;e++){const n=this.shapePoints[e];t.lineTo(Math.cos(n.angle)*s*n.scale,Math.sin(n.angle)*s*n.scale)}t.closePath(),t.strokeStyle="#ffffff",t.lineWidth=2,t.stroke(),t.restore()}setVelocity(t){this.velocity=t}split(){if(!this.shouldSplit||this.hasSplit)return[];this.hasSplit=!0;const t=I[this.size];if(!t)return[];const s=this.radius*.8,i=Math.random()*Math.PI*2,e=Math.cos(i)*s,n=Math.sin(i)*s,o=new c({x:this.position.x+e,y:this.position.y+n},t),a=new c({x:this.position.x-e,y:this.position.y-n},t);return o.setVelocity({x:this.velocity.x+e*2,y:this.velocity.y+n*2}),a.setVelocity({x:this.velocity.x-e*2,y:this.velocity.y-n*2}),[o,a]}onCollision(t){if(t instanceof m){this.shouldSplit=!0,this.alive=!1;return}t instanceof c&&c.resolveCollision(this,t)}static resolveCollision(t,s){const i=s.position.x-t.position.x,e=s.position.y-t.position.y,n=Math.hypot(i,e)||1,o=i/n,a=e/n,r=t.radius+s.radius-n;if(r>0){const f=r/2;t.position.x-=o*f,t.position.y-=a*f,s.position.x+=o*f,s.position.y+=a*f}const h=s.velocity.x-t.velocity.x,p=s.velocity.y-t.velocity.y,y=h*o+p*a;if(y>0)return;const d=-1.9*y/2,u=d*o,v=d*a;t.velocity.x-=u,t.velocity.y-=v,s.velocity.x+=u,s.velocity.y+=v}}class R extends S{player;asteroids=[];onInit(){this.player=new C({x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2},new L(this.input)),this.addEntity(this.player),this.addAsteroid(new c({x:150,y:120},"XL")),this.addAsteroid(new c({x:650,y:200},"L")),this.addAsteroid(new c({x:400,y:450},"M"))}update(t){if(this.input.wasPressed(" ")){const i=this.player.getAngle(),e=i*Math.PI/180,n=this.player.radius*1.2,o={x:this.player.position.x+Math.cos(e)*n,y:this.player.position.y+Math.sin(e)*n};this.addEntity(new m(o,i))}super.update(t);const s=[];this.asteroids=this.asteroids.filter(i=>i.alive?!0:(s.push(...i.split()),!1));for(const i of s)this.addAsteroid(i)}addAsteroid(t){this.asteroids.push(t),this.addEntity(t)}}const x=new R;x.init({selector:"#app",width:800,height:600,backgroundColor:"#000000"});x.start();
