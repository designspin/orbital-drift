(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();class f{gameTime=0;maxStep=.05;lastTime=0;fps=0;isPaused=!1;tick(){if(this.isPaused)return 0;const t=performance.now();let n=(t-this.lastTime)/1e3;return this.fps=1e3/(t-this.lastTime),this.lastTime=t,n>this.maxStep&&(n=this.maxStep),this.gameTime+=n,n}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTime=performance.now()}getGameTime(){return this.gameTime}getFPS(){return Math.round(this.fps)}}class m{keys=new Set;justPressed=new Set;justReleased=new Set;onKeyDown=t=>{t.repeat||(this.keys.add(t.key),this.justPressed.add(t.key))};onKeyUp=t=>{this.keys.delete(t.key),this.justReleased.add(t.key)};constructor(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}update(){this.justPressed.clear(),this.justReleased.clear()}isDown(t){return this.keys.has(t)}wasPressed(t){return this.justPressed.has(t)}wasReleased(t){return this.justReleased.has(t)}}class g{entities=[];add(t){this.entities.push(t)}remove(t){this.entities=this.entities.filter(n=>n!==t)}update(t,n){for(const e of this.entities)e.update(t,n);this.handleCollisions(),this.entities=this.entities.filter(e=>e.alive)}render(t){for(const n of this.entities)n.render(t)}clear(){this.entities=[]}handleCollisions(){const t=this.entities.filter(e=>"colliderType"in e),n=e=>typeof e.layer=="number"&&typeof e.mask=="number";for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++){const s=t[e],o=t[i];if(n(s)&&n(o)&&((s.mask&o.layer)===0||(o.mask&s.layer)===0))continue;let l=!1;if(s.colliderType==="circle"&&o.colliderType==="circle"){const r=s.position.x-o.position.x,a=s.position.y-o.position.y;Math.sqrt(r*r+a*a)<s.radius+o.radius&&(l=!0)}else if(s.colliderType==="box"&&o.colliderType==="box")s.position.x<o.position.x+o.width&&s.position.x+s.width>o.position.x&&s.position.y<o.position.y+o.height&&s.position.y+s.height>o.position.y&&(l=!0);else{let r,a;s.colliderType==="circle"?(r=s,a=o):(r=o,a=s);const c=Math.max(a.position.x,Math.min(r.position.x,a.position.x+a.width)),y=Math.max(a.position.y,Math.min(r.position.y,a.position.y+a.height)),u=r.position.x-c,d=r.position.y-y;u*u+d*d<r.radius*r.radius&&(l=!0)}l&&(s.onCollision(o),o.onCollision(s))}}}class w{timer=new f;input=new m;entityManager=new g;isRunning=!1;hasLoopStarted=!1;ctx;uiLayers=[];uiCanvas;uiCtx;uiUpdateIntervalMs=0;uiTimeSinceUpdateMs=0;get screenSize(){return{x:this.ctx.canvas.width,y:this.ctx.canvas.height}}get running(){return this.isRunning}init(t){const n=document.querySelector(t.selector);if(!n)throw new Error(`Element with selector "${t.selector}" not found.`);const e=document.createElement("canvas");e.width=t.width||800,e.height=t.height||600,e.style.backgroundColor=t.backgroundColor||"black",e.id="game",n.appendChild(e),e.focus();const i=e.getContext("2d");if(!i)throw new Error("Failed to get 2D context from canvas.");this.ctx=i,this.onInit()}onInit(){}start(){this.isRunning||(this.isRunning=!0,this.timer.resume(),this.onResume(),this.hasLoopStarted||(this.hasLoopStarted=!0,requestAnimationFrame(this.gameLoop.bind(this))))}stop(){this.isRunning=!1,this.timer.pause(),this.onPause()}onPause(){}onResume(){}canTogglePause(){return!0}gameLoop(){this.input.wasPressed("Escape")&&this.canTogglePause()&&(this.isRunning?this.stop():(this.isRunning=!0,this.timer.resume(),this.onResume()));let t=0;this.isRunning&&(t=this.timer.tick(),this.update(t),this.render());const n=this.isRunning?t:1/60;this.updateAndRenderUI(n),this.input.update(),requestAnimationFrame(this.gameLoop.bind(this))}update(t){this.entityManager.update(t,this.screenSize)}render(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.entityManager.render(this.ctx),t&&t(),this.ctx.restore()}updateAndRenderUI(t){if(!this.uiCtx||this.uiLayers.length===0||(this.uiTimeSinceUpdateMs+=t*1e3,this.uiUpdateIntervalMs>0&&this.uiTimeSinceUpdateMs<this.uiUpdateIntervalMs))return;this.uiTimeSinceUpdateMs=0;const n=this.uiCanvas.width,e=this.uiCanvas.height;for(const i of this.uiLayers)i.update(t);this.uiCtx.clearRect(0,0,n,e);for(const i of this.uiLayers)i.render(this.uiCtx,n,e)}addUILayer(t){this.uiCtx||this.createUiCanvas(),this.uiLayers.push(t)}removeUILayer(t){this.uiLayers=this.uiLayers.filter(n=>n!==t)}setUiUpdateInterval(t){this.uiUpdateIntervalMs=Math.max(0,t)}createUiCanvas(){const t=this.ctx.canvas.parentElement;if(!t)return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");const e=document.createElement("canvas");e.width=this.ctx.canvas.width,e.height=this.ctx.canvas.height,e.style.position="absolute",e.style.left="0",e.style.top="0";const i=this.ctx.canvas,s=window.getComputedStyle(i);e.style.width=s.width||i.style.width||"100%",e.style.height=s.height||i.style.height||"100%",e.style.aspectRatio=s.aspectRatio||i.style.aspectRatio||`${i.width} / ${i.height}`,e.style.objectFit=s.objectFit||i.style.objectFit||"contain",e.style.display=s.display||"block",e.style.pointerEvents="none",e.style.zIndex="2",e.id="ui",t.appendChild(e);const o=e.getContext("2d");if(!o)throw new Error("Failed to get 2D context from UI canvas.");this.uiCanvas=e,this.uiCtx=o}addEntity(t){this.entityManager.add(t)}}class x{position;alive;constructor(t={x:0,y:0},n=!0){this.position=t,this.alive=n}}class v{input;constructor(t){this.input=t}getRotation(){return this.input.isDown("ArrowLeft")?-1:this.input.isDown("ArrowRight")?1:0}isThrusting(){return this.input.isDown("ArrowUp")}}class C extends x{angle=0;velocity={x:0,y:0};thrust=0;friction=.98;controller;screenSize;constructor(t,n,e={x:800,y:600}){super(t),this.controller=n,this.screenSize=e}update(t,n){this.angle+=this.controller.getRotation()*180*t,this.controller.isThrusting()?this.thrust=200:this.thrust=0,this.velocity.x+=Math.cos(this.angle*Math.PI/180)*this.thrust*t,this.velocity.y+=Math.sin(this.angle*Math.PI/180)*this.thrust*t,this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t;const e=n.x,i=n.y;this.position.x<0&&(this.position.x+=e),this.position.x>e&&(this.position.x-=e),this.position.y<0&&(this.position.y+=i),this.position.y>i&&(this.position.y-=i)}render(t){t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle*Math.PI/180),t.beginPath(),t.moveTo(20,0),t.lineTo(-15,-10),t.lineTo(-10,0),t.lineTo(-15,10),t.closePath(),t.fillStyle="#b300ff",t.fill(),t.restore()}}class M extends w{onInit(){const t=new C({x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2},new v(this.input));this.addEntity(t)}}const p=new M;p.init({selector:"#app",width:800,height:600,backgroundColor:"#000000"});p.start();
