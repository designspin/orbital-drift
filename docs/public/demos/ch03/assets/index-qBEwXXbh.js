(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class y{gameTime=0;maxStep=.05;lastTime=0;fps=0;isPaused=!1;tick(){if(this.isPaused)return 0;const t=performance.now();let n=(t-this.lastTime)/1e3;return this.fps=1e3/(t-this.lastTime),this.lastTime=t,n>this.maxStep&&(n=this.maxStep),this.gameTime+=n,n}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTime=performance.now()}getGameTime(){return this.gameTime}getFPS(){return Math.round(this.fps)}}class m{keys=new Set;justPressed=new Set;justReleased=new Set;onKeyDown=t=>{t.repeat||(this.keys.add(t.key),this.justPressed.add(t.key))};onKeyUp=t=>{this.keys.delete(t.key),this.justReleased.add(t.key)};constructor(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}update(){this.justPressed.clear(),this.justReleased.clear()}isDown(t){return this.keys.has(t)}wasPressed(t){return this.justPressed.has(t)}wasReleased(t){return this.justReleased.has(t)}}class g{entities=[];add(t){this.entities.push(t)}remove(t){this.entities=this.entities.filter(n=>n!==t)}update(t,n){for(const e of this.entities)e.update(t,n);this.handleCollisions(),this.entities=this.entities.filter(e=>e.alive)}render(t){for(const n of this.entities)n.render(t)}clear(){this.entities=[]}handleCollisions(){const t=this.entities.filter(e=>"colliderType"in e),n=e=>typeof e.layer=="number"&&typeof e.mask=="number";for(let e=0;e<t.length;e++)for(let s=e+1;s<t.length;s++){const i=t[e],o=t[s];if(n(i)&&n(o)&&((i.mask&o.layer)===0||(o.mask&i.layer)===0))continue;let c=!1;if(i.colliderType==="circle"&&o.colliderType==="circle"){const a=i.position.x-o.position.x,r=i.position.y-o.position.y;Math.sqrt(a*a+r*r)<i.radius+o.radius&&(c=!0)}else if(i.colliderType==="box"&&o.colliderType==="box")i.position.x<o.position.x+o.width&&i.position.x+i.width>o.position.x&&i.position.y<o.position.y+o.height&&i.position.y+i.height>o.position.y&&(c=!0);else{let a,r;i.colliderType==="circle"?(a=i,r=o):(a=o,r=i);const l=Math.max(r.position.x,Math.min(a.position.x,r.position.x+r.width)),f=Math.max(r.position.y,Math.min(a.position.y,r.position.y+r.height)),d=a.position.x-l,u=a.position.y-f;d*d+u*u<a.radius*a.radius&&(c=!0)}c&&(i.onCollision(o),o.onCollision(i))}}}class x{timer=new y;input=new m;entityManager=new g;isRunning=!1;hasLoopStarted=!1;ctx;uiLayers=[];uiCanvas;uiCtx;uiUpdateIntervalMs=0;uiTimeSinceUpdateMs=0;get screenSize(){return{x:this.ctx.canvas.width,y:this.ctx.canvas.height}}get running(){return this.isRunning}init(t){const n=document.querySelector(t.selector);if(!n)throw new Error(`Element with selector "${t.selector}" not found.`);const e=document.createElement("canvas");e.width=t.width||800,e.height=t.height||600,e.style.backgroundColor=t.backgroundColor||"black",e.id="game",n.appendChild(e),e.focus();const s=e.getContext("2d");if(!s)throw new Error("Failed to get 2D context from canvas.");this.ctx=s,this.onInit()}onInit(){}start(){this.isRunning||(this.isRunning=!0,this.timer.resume(),this.onResume(),this.hasLoopStarted||(this.hasLoopStarted=!0,requestAnimationFrame(this.gameLoop.bind(this))))}stop(){this.isRunning=!1,this.timer.pause(),this.onPause()}onPause(){}onResume(){}canTogglePause(){return!0}gameLoop(){this.input.wasPressed("Escape")&&this.canTogglePause()&&(this.isRunning?this.stop():(this.isRunning=!0,this.timer.resume(),this.onResume()));let t=0;this.isRunning&&(t=this.timer.tick(),this.update(t),this.render());const n=this.isRunning?t:1/60;this.updateAndRenderUI(n),this.input.update(),requestAnimationFrame(this.gameLoop.bind(this))}update(t){this.entityManager.update(t,this.screenSize)}render(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.entityManager.render(this.ctx),t&&t(),this.ctx.restore()}updateAndRenderUI(t){if(!this.uiCtx||this.uiLayers.length===0||(this.uiTimeSinceUpdateMs+=t*1e3,this.uiUpdateIntervalMs>0&&this.uiTimeSinceUpdateMs<this.uiUpdateIntervalMs))return;this.uiTimeSinceUpdateMs=0;const n=this.uiCanvas.width,e=this.uiCanvas.height;for(const s of this.uiLayers)s.update(t);this.uiCtx.clearRect(0,0,n,e);for(const s of this.uiLayers)s.render(this.uiCtx,n,e)}addUILayer(t){this.uiCtx||this.createUiCanvas(),this.uiLayers.push(t)}removeUILayer(t){this.uiLayers=this.uiLayers.filter(n=>n!==t)}setUiUpdateInterval(t){this.uiUpdateIntervalMs=Math.max(0,t)}createUiCanvas(){const t=this.ctx.canvas.parentElement;if(!t)return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");const e=document.createElement("canvas");e.width=this.ctx.canvas.width,e.height=this.ctx.canvas.height,e.style.position="absolute",e.style.left="0",e.style.top="0";const s=this.ctx.canvas,i=window.getComputedStyle(s);e.style.width=i.width||s.style.width||"100%",e.style.height=i.height||s.style.height||"100%",e.style.aspectRatio=i.aspectRatio||s.style.aspectRatio||`${s.width} / ${s.height}`,e.style.objectFit=i.objectFit||s.style.objectFit||"contain",e.style.display=i.display||"block",e.style.pointerEvents="none",e.style.zIndex="2",e.id="ui",t.appendChild(e);const o=e.getContext("2d");if(!o)throw new Error("Failed to get 2D context from UI canvas.");this.uiCanvas=e,this.uiCtx=o}addEntity(t){this.entityManager.add(t)}}class w extends x{cubeAngle=0;cubeSize=0;update(t){this.cubeAngle+=90*t,this.cubeAngle>=360&&(this.cubeAngle-=360);const n=this.timer.getGameTime();this.cubeSize=100+50*Math.sin(n*2)}render(){super.render(()=>{const t=this.ctx.canvas.width/2,n=this.ctx.canvas.height/2,e=this.cubeSize;this.ctx.save(),this.ctx.translate(t,n),this.ctx.rotate(this.cubeAngle*Math.PI/180),this.ctx.fillStyle="#203897",this.ctx.fillRect(-e/2,-e/2,e,e),this.ctx.restore(),this.ctx.fillStyle="#ffffff",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.fillText(`Game Loop Running... FPS: ${this.timer.getFPS()}`,this.ctx.canvas.width/2,this.ctx.canvas.height-10)})}}const p=new w;p.init({selector:"#app",width:800,height:600,backgroundColor:"#4433ee"});p.start();
