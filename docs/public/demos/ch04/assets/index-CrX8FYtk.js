(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class f{gameTime=0;maxStep=.05;lastTime=0;fps=0;isPaused=!1;tick(){if(this.isPaused)return 0;const t=performance.now();let n=(t-this.lastTime)/1e3;return this.fps=1e3/(t-this.lastTime),this.lastTime=t,n>this.maxStep&&(n=this.maxStep),this.gameTime+=n,n}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTime=performance.now()}getGameTime(){return this.gameTime}getFPS(){return Math.round(this.fps)}}class m{keys=new Set;justPressed=new Set;justReleased=new Set;onKeyDown=t=>{t.repeat||(this.keys.add(t.key),this.justPressed.add(t.key))};onKeyUp=t=>{this.keys.delete(t.key),this.justReleased.add(t.key)};constructor(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}dispose(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}update(){this.justPressed.clear(),this.justReleased.clear()}isDown(t){return this.keys.has(t)}wasPressed(t){return this.justPressed.has(t)}wasReleased(t){return this.justReleased.has(t)}}class g{entities=[];add(t){this.entities.push(t)}remove(t){this.entities=this.entities.filter(n=>n!==t)}update(t,n){for(const e of this.entities)e.update(t,n);this.handleCollisions(),this.entities=this.entities.filter(e=>e.alive)}render(t){for(const n of this.entities)n.render(t)}clear(){this.entities=[]}handleCollisions(){const t=this.entities.filter(e=>"colliderType"in e),n=e=>typeof e.layer=="number"&&typeof e.mask=="number";for(let e=0;e<t.length;e++)for(let s=e+1;s<t.length;s++){const i=t[e],a=t[s];if(n(i)&&n(a)&&((i.mask&a.layer)===0||(a.mask&i.layer)===0))continue;let l=!1;if(i.colliderType==="circle"&&a.colliderType==="circle"){const r=i.position.x-a.position.x,o=i.position.y-a.position.y;Math.sqrt(r*r+o*o)<i.radius+a.radius&&(l=!0)}else if(i.colliderType==="box"&&a.colliderType==="box")i.position.x<a.position.x+a.width&&i.position.x+i.width>a.position.x&&i.position.y<a.position.y+a.height&&i.position.y+i.height>a.position.y&&(l=!0);else{let r,o;i.colliderType==="circle"?(r=i,o=a):(r=a,o=i);const c=Math.max(o.position.x,Math.min(r.position.x,o.position.x+o.width)),y=Math.max(o.position.y,Math.min(r.position.y,o.position.y+o.height)),d=r.position.x-c,u=r.position.y-y;d*d+u*u<r.radius*r.radius&&(l=!0)}l&&(i.onCollision(a),a.onCollision(i))}}}class x{timer=new f;input=new m;entityManager=new g;isRunning=!1;hasLoopStarted=!1;ctx;uiLayers=[];uiCanvas;uiCtx;uiUpdateIntervalMs=0;uiTimeSinceUpdateMs=0;get screenSize(){return{x:this.ctx.canvas.width,y:this.ctx.canvas.height}}get running(){return this.isRunning}init(t){const n=document.querySelector(t.selector);if(!n)throw new Error(`Element with selector "${t.selector}" not found.`);const e=document.createElement("canvas");e.width=t.width||800,e.height=t.height||600,e.style.backgroundColor=t.backgroundColor||"black",e.id="game",n.appendChild(e),e.focus();const s=e.getContext("2d");if(!s)throw new Error("Failed to get 2D context from canvas.");this.ctx=s,this.onInit()}onInit(){}start(){this.isRunning||(this.isRunning=!0,this.timer.resume(),this.onResume(),this.hasLoopStarted||(this.hasLoopStarted=!0,requestAnimationFrame(this.gameLoop.bind(this))))}stop(){this.isRunning=!1,this.timer.pause(),this.onPause()}onPause(){}onResume(){}canTogglePause(){return!0}gameLoop(){this.input.wasPressed("Escape")&&this.canTogglePause()&&(this.isRunning?this.stop():(this.isRunning=!0,this.timer.resume(),this.onResume()));let t=0;this.isRunning&&(t=this.timer.tick(),this.update(t),this.render());const n=this.isRunning?t:1/60;this.updateAndRenderUI(n),this.input.update(),requestAnimationFrame(this.gameLoop.bind(this))}update(t){this.entityManager.update(t,this.screenSize)}render(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.save(),this.entityManager.render(this.ctx),t&&t(),this.ctx.restore()}updateAndRenderUI(t){if(!this.uiCtx||this.uiLayers.length===0||(this.uiTimeSinceUpdateMs+=t*1e3,this.uiUpdateIntervalMs>0&&this.uiTimeSinceUpdateMs<this.uiUpdateIntervalMs))return;this.uiTimeSinceUpdateMs=0;const n=this.uiCanvas.width,e=this.uiCanvas.height;for(const s of this.uiLayers)s.update(t);this.uiCtx.clearRect(0,0,n,e);for(const s of this.uiLayers)s.render(this.uiCtx,n,e)}addUILayer(t){this.uiCtx||this.createUiCanvas(),this.uiLayers.push(t)}removeUILayer(t){this.uiLayers=this.uiLayers.filter(n=>n!==t)}setUiUpdateInterval(t){this.uiUpdateIntervalMs=Math.max(0,t)}createUiCanvas(){const t=this.ctx.canvas.parentElement;if(!t)return;window.getComputedStyle(t).position==="static"&&(t.style.position="relative");const e=document.createElement("canvas");e.width=this.ctx.canvas.width,e.height=this.ctx.canvas.height,e.style.position="absolute",e.style.left="0",e.style.top="0";const s=this.ctx.canvas,i=window.getComputedStyle(s);e.style.width=i.width||s.style.width||"100%",e.style.height=i.height||s.style.height||"100%",e.style.aspectRatio=i.aspectRatio||s.style.aspectRatio||`${s.width} / ${s.height}`,e.style.objectFit=i.objectFit||s.style.objectFit||"contain",e.style.display=i.display||"block",e.style.pointerEvents="none",e.style.zIndex="2",e.id="ui",t.appendChild(e);const a=e.getContext("2d");if(!a)throw new Error("Failed to get 2D context from UI canvas.");this.uiCanvas=e,this.uiCtx=a}addEntity(t){this.entityManager.add(t)}}class w extends x{playerAngle=0;playerVelocity=0;playerThrust=0;playerX=400;playerY=300;playerFriction=.98;update(t){this.input.isDown("ArrowLeft")&&(this.playerAngle-=180*t),this.input.isDown("ArrowRight")&&(this.playerAngle+=180*t),this.input.isDown("ArrowUp")?this.playerThrust=200:this.playerThrust=0,this.playerVelocity+=this.playerThrust*t,this.playerVelocity*=this.playerFriction,this.playerX+=Math.cos(this.playerAngle*Math.PI/180)*this.playerVelocity*t,this.playerY+=Math.sin(this.playerAngle*Math.PI/180)*this.playerVelocity*t;const n=this.ctx.canvas.width,e=this.ctx.canvas.height;this.playerX<0&&(this.playerX+=n),this.playerX>n&&(this.playerX-=n),this.playerY<0&&(this.playerY+=e),this.playerY>e&&(this.playerY-=e)}render(){super.render(()=>{this.ctx.save(),this.ctx.translate(this.playerX,this.playerY),this.ctx.rotate(this.playerAngle*Math.PI/180),this.ctx.beginPath(),this.ctx.moveTo(20,0),this.ctx.lineTo(-15,-10),this.ctx.lineTo(-10,0),this.ctx.lineTo(-15,10),this.ctx.closePath(),this.ctx.fillStyle="#00ff00",this.ctx.fill(),this.ctx.restore(),this.ctx.fillStyle="#ffffff",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.fillText(`Game Loop Running... FPS: ${this.timer.getFPS()}`,this.ctx.canvas.width/2,this.ctx.canvas.height-10)})}}const p=new w;p.init({selector:"#app",width:800,height:600,backgroundColor:"black"});p.start();
